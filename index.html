<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>NON PLAYABLE CHARACTER</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #000;
            text-align: center;
        }
        header {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 18px;
        }
        h1 {
            margin: 0;
            font-size: 1.2rem;
            color: white;
        }
        img {
            max-width: 90%;
            height: auto;
            border: 5px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .note {
            margin-top: 12px;
            font-size: 0.9rem;
            color: #ccc;
        }
    </style>
</head>
<body>

    <header>
        <h1>NON PLAYABLE CHARACTER!</h1>
    </header>

    <main>
        <img id="randomImage" src="" alt="A sequential image">
    </main>

    <div class="note"> <strong></strong>  <strong></strong>  <strong> </strong></div>
    
    <script>
        // --- CONFIGURATION ---
        const seriesData = {
            'series1': {
                basePath: "",
                totalImages: 31,
                storageKey: "npcImageIndex_series1"
            },
            'series2': {
                basePath: "series2/",
                totalImages: 31, // Adjust if series 2 has a different number of images
                storageKey: "npcImageIndex_series2"
            }
        };
        const extension = ".jpg";
        const initialSeries = 'series1';
        // ---------------------

        const imageElement = document.getElementById('randomImage');
        let currentSeries = initialSeries;

        function getCurrentConfig() {
            return seriesData[currentSeries];
        }

        function getNextIndexFromStorage() {
            const config = getCurrentConfig();
            let last = parseInt(localStorage.getItem(config.storageKey) || "0", 10);
            if (!Number.isFinite(last) || last < 0) last = 0;
            let nextIndex = last + 1;
            if (nextIndex > config.totalImages) nextIndex = 1;
            return nextIndex;
        }

        function saveCurrentIndex(idx) {
            const config = getCurrentConfig();
            localStorage.setItem(config.storageKey, String(idx));
        }

        let attemptsGlobal = 0;
        function tryShow(idx) {
            const config = getCurrentConfig();
            let attempts = 0;
            imageElement.onerror = function () {
                attempts++;
                attemptsGlobal++;
                if (attempts < config.totalImages && attemptsGlobal < config.totalImages * 2) {
                    idx = idx + 1;
                    if (idx > config.totalImages) idx = 1;
                    saveCurrentIndex(idx);
                    imageElement.src = config.basePath + idx + extension;
                } else {
                    imageElement.onerror = null;
                    imageElement.alt = "No images found in this series.";
                }
            };
            imageElement.src = config.basePath + idx + extension;
            saveCurrentIndex(idx);
        }

        function advanceImage() {
            const config = getCurrentConfig();
            let last = parseInt(localStorage.getItem(config.storageKey) || "0", 10);
            if (!Number.isFinite(last) || last < 0) last = 0;
            let next = last + 1;
            if (next > config.totalImages) next = 1;
            tryShow(next);
        }

        function resetSequenceToStart() {
            tryShow(1);
        }

        function switchSeries() {
            currentSeries = (currentSeries === 'series1') ? 'series2' : 'series1';
            // Load the last viewed image from the new series, or the first one if none.
            const indexToShow = getNextIndexFromStorage();
            tryShow(indexToShow);
        }

        // Initial load
        tryShow(getNextIndexFromStorage());

        // Keyboard support
        document.addEventListener('keydown', function (e) {
            const tgt = e.target;
            if (tgt && (tgt.tagName === 'INPUT' || tgt.tagName === 'TEXTAREA' || tgt.isContentEditable)) return;

            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault();
                advanceImage();
                return;
            }

            if (e.code === 'KeyR' || e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                resetSequenceToStart();
                return;
            }

            if (e.code === 'KeyK' || e.key === 'k' || e.key === 'K') {
                e.preventDefault();
                switchSeries();
                return;
            }
        });
    </script>

</body>
</html>
