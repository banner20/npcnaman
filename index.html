<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>NON PLAYABLE CHARACTER</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        header {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 18px;
        }
        h1 {
            margin: 0;
            font-size: 1.2rem;
        }
        img {
            max-width: 90%;
            height: auto;
            border: 5px solid white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .note {
            margin-top: 12px;
            font-size: 0.9rem;
            color: #555;
        }
    </style>
</head>
<body>

    <header>
        <h1>NON PLAYABLE CHARACTER!</h1>
    </header>

    <main>
        <img id="randomImage" src="" alt="A sequential image">
    </main>

    <div class="note">Press <strong>Space</strong> to advance. Press <strong>R</strong> to reset to the first image. Sequence persists per user in this browser.</div>
    
    <script>
        // CONFIG: adjust these to match your setup
        const totalImages = 31;      // set this to how many images you actually have (e.g. 30)
        const basePath = "";         // e.g. "images/" if files are in /images/
        const extension = ".jpg";    // change if PNG or different

        const imageElement = document.getElementById('randomImage');
        const storageKey = "npcImageIndex";

        // Read last shown index (0 if none), compute next index to show
        function getNextIndexFromStorage() {
            let last = parseInt(localStorage.getItem(storageKey) || "0", 10);
            if (!Number.isFinite(last) || last < 0) last = 0;
            let nextIndex = last + 1;
            if (nextIndex > totalImages) nextIndex = 1;
            return nextIndex;
        }

        // Save index (index of the image currently shown)
        function saveCurrentIndex(idx) {
            localStorage.setItem(storageKey, String(idx));
        }

        // Try to show image idx; if it 404s we'll advance up to totalImages times
        let attemptsGlobal = 0;
        function tryShow(idx) {
            let attempts = 0;
            imageElement.onerror = function () {
                attempts++;
                attemptsGlobal++;
                if (attempts < totalImages && attemptsGlobal < totalImages * 2) {
                    idx = idx + 1;
                    if (idx > totalImages) idx = 1;
                    saveCurrentIndex(idx);
                    imageElement.src = basePath + idx + extension;
                } else {
                    imageElement.onerror = null;
                    imageElement.alt = "No images found at the configured paths.";
                }
            };
            // set src and save it as the current shown index
            imageElement.src = basePath + idx + extension;
            saveCurrentIndex(idx);
        }

        // Advance one image (used by Spacebar)
        function advanceImage() {
            let last = parseInt(localStorage.getItem(storageKey) || "0", 10);
            if (!Number.isFinite(last) || last < 0) last = 0;
            let next = last + 1;
            if (next > totalImages) next = 1;
            tryShow(next);
        }

        // Reset sequence to first image (used by R key)
        function resetSequenceToStart() {
            tryShow(1); // tryShow saves index -> next refresh will show 2
        }

        // On load: compute next index and show it
        const indexToShow = getNextIndexFromStorage();
        tryShow(indexToShow);

        // Keyboard support:
        // - Space: advance (prevents page scroll; ignores typing fields)
        // - R: reset to first image (ignores typing fields)
        document.addEventListener('keydown', function (e) {
            const tgt = e.target;
            // ignore when typing in input/textarea or contenteditable
            if (tgt && (tgt.tagName === 'INPUT' || tgt.tagName === 'TEXTAREA' || tgt.isContentEditable)) return;

            // Space advances
            if (e.code === 'Space' || e.key === ' ') {
                e.preventDefault(); // prevent page scroll
                advanceImage();
                return;
            }

            // R resets to start (handle both lowercase and uppercase)
            if (e.code === 'KeyR' || e.key === 'r' || e.key === 'R') {
                e.preventDefault();
                resetSequenceToStart();
                return;
            }
        });
    </script>

</body>
</html>
